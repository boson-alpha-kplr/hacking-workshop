### Roasting AES

- Tr√®s similaire au Kerberoasting, AS-REP Roasting dump les hachages krbasrep5 des comptes d'utilisateurs pour lesquels la pr√©-authentification Kerberos est d√©sactiv√©e.   

- Contrairement √† Kerberoasting, ces utilisateurs n'ont pas besoin d'√™tre des comptes de service, la seule exigence pour pouvoir griller AS-REP un utilisateur est que l'utilisateur doit avoir d√©sactiv√© la pr√©-authentification.

- **Lecture Utile Pr√©alable** : https://thehackernews.com/2021/09/what-is-as-rep-roasting-attack-really.html

- L'une des premi√®res √©tapes de l'authentification Kerberos est **la pr√©-authentification**. La pr√©-authentification utilise le mot de passe de l'utilisateur pour chiffrer un horodatage (timestamp).   
- Le contr√¥leur de domaine (DC) d√©chiffrera cela pour valider le mot de passe correct et ne pas rejouer une demande pr√©c√©dente (**replay attack**). 
- <ins>Une vuln√©rabilit√© peut donc survenir lorsque la pr√©-authentification est d√©sactiv√©e.</ins>

- Une fois cette option d√©sactiv√©e, un pirate peut demander des donn√©es d'authentification pour n'importe quel utilisateur, et le contr√¥leur de domaine renverra un ticket d'octroi de ticket (TGT) crypt√©.  
-  Il peut ensuite √™tre utilis√© pour forcer brutalement dans un environnement hors ligne pour d√©chiffrer le mot de passe.

### Outillage üõ†Ô∏è :

- Nous continuerons √† utiliser Rubeus comme nous l'avons fait avec le kerberoasting et le harvesting, car Rubeus a une commande tr√®s simple et facile √† comprendre pour roaster AS-REP et attaquer les utilisateurs avec la pr√©-authentification Kerberos d√©sactiv√©e.  
-
- Apr√®s avoir dump√© le hash de Rubeus, nous utiliserons hashcat afin de casser le hachage krbasrep5.

- Il existe √©galement d'autres outils pour le roasting AS-REP tels que kekeo et GetNPUsers.py d'Imppacket.  
- Rubeus est plus facile √† utiliser car il trouve automatiquement les utilisateurs AS-REP Roastable alors qu'avec GetNPUsers, vous devez √©num√©rer les utilisateurs au pr√©alable et savoir quels utilisateurs peuvent √™tre "AS-REP Roastable".

Rubeus est d√©j√† copil√© sur la machine cible üôå

---

**R√©sum√© du Roasting AS-REP** -

- Lors de la pr√©-authentification, le hachage des utilisateurs sera utilis√© pour chiffrer un horodatage que le contr√¥leur de domaine tentera de d√©chiffrer pour valider que le bon hachage est utilis√© et ne relit pas une demande pr√©c√©dente.  
- 
- Apr√®s avoir valid√© l'horodatage, le KDC √©mettra un TGT pour l'utilisateur.  
- **_Si la pr√©-authentification est d√©sactiv√©e, vous pouvez demander des donn√©es d'authentification pour n'importe quel utilisateur et le KDC renverra un TGT crypt√© qui peut √™tre craqu√© offline_** car le KDC saute l'√©tape de validation dufait que "l'utilisateur est vraiment ce qu'il pr√©tend √™tre".

---

**Dumping des hash KRBASREP5 avec Rubeus** -

1.) ```cd Downloads```- acc√©dez au r√©pertoire dans lequel se trouve Rubeus

2.) ```Rubeus.exe asreproast``` - Cela ex√©cutera la commande AS-REP roast√© √† la recherche d'utilisateurs vuln√©rables, puis dumpera les hachages d'utilisateurs vuln√©rables trouv√©s.

**Crack des hashes avec hashcat** -

1.) Transf√©rez le hachage de la machine cible vers votre machine attaquante et placez le hachage dans un fichier txt

2.) Ins√©rez 23$ apr√®s $krb5asrep$ pour que la premi√®re ligne soit $krb5asrep$23$User.....

Utilisez la m√™me liste de mots que vous avez t√©l√©charg√©e dans la t√¢che 4

3.) ```hashcat -x nnnn aaaa bbbb``` - crackez ces hachages ! 
Hint : trouvez le mode hashcat qui convient pour ce type de roasting AS-REP (5 chiffres)
Si vous √™tes coinc√©s demandez-le au formateur.

**Mitigation de roasting AS-REP**

Ayez une politique de mot de passe fort. Avec un mot de passe fort, les hachages mettront plus de temps √† se fissurer, rendant cette attaque moins efficace
Ne d√©sactivez pas la pr√©-authentification Kerberos, sauf si cela est n√©cessaire, il n'y a presque pas d'autre moyen d'att√©nuer compl√®tement cette attaque que de maintenir la pr√©-authentification activ√©e.

**R√©pondre aux questions ci-dessous**


Quel type de hachage utilise AS-REP Roasting ?
```
reponse
```
qu'est ce que KRBASREP5 ?
```
reponse
```
Quel utilisateur est vuln√©rable au Roasting AS-REP¬†?
```
reponse
```
Quel est le mot de passe de l'utilisateur ?
```
reponse
```
Quel administrateur est vuln√©rable au Roasting AS-REP¬†?
```
reponse
```
Quel est le mot de passe de l'administrateur¬†?
```
reponse
```
Quel est le mot de passe de l'administrateur¬†?
```
reponse
```
Quelle est la diff√©rence de cette attaque par rapport aux pr√©c√©dentes ?
```
reponse
```
Dans quel cas peut-il √™tre avantageux de l'utiliser par rapport aux autres ?
```
reponse
```
---

**BONUS :** Si vous avez termin√© rapidement, tentez la m√™me attaque avec Impacket
